import numpy as np
import pandas as pd
import random as rd
import math
import matplotlib.pyplot as plt

#Instalando o ACO-PANTS, deve ser executado pelo menos uma vez
!pip install ACO-PANTS
!pip install ipython-autotime
%load_ext autotime

import pants

url = "https://raw.githubusercontent.com/luisdurante/IA-II-algoritmo-genetico-carrinho-de-compras/master/amostra.csv"
df = pd.read_csv("https://raw.githubusercontent.com/luisdurante/IA-II-algoritmo-genetico-carrinho-de-compras/master/amostra.csv", sep=';')
df.head()

df.drop(columns=['produto', 'prioridade', 'categoria'], axis='1', inplace=True)
df.head()



nodes = []
records = df.to_records(index=False)
nodes = list(records)
print(nodes)

def nota(a, b):
    #Baseado em valor nutritivo
    return math.sqrt(pow((a[1]*5)/a[0], 2) + pow((b[1]*5)/b[0], 2))
  
    
    
    #Orçamento do cliente
precoLimite = 100

#Criação do mundo para as formigas
world = pants.World(nodes, nota)

#Construção do solver
solver = pants.Solver()

#Carrinho com a melhor solução
carrinho = []

#Variáveis de avaliação da solução
fatorben = 0.0
preco = 0.0
valor = 0.0
valornut = 0
benMinimo = 1.5

#Variáveis delimitadoras
iter = 10
i = 0
j = 0
#Utilizado junto ao beneficio minimo, garante que a solução atenda o custo 
#benefício mínimo esperado
halt = 1

while (j < iter):
  #Faz a otimização
  solution = solver.solve(world)
  lista = (solution.tour)
  #Cria um carrinho válido (dentro do orçamento) particionando o vetor
  for x in lista:
    if ((valor + x[0]) <= precoLimite):
      valor = valor + x[0]
      valornut = valornut + x[1]
      i = i + 1
    else:
      #Avalia o carrinho, substituindo o antigo caso encontre um melhor
      if ((valornut*5/valor) > fatorben):
        carrinho.clear
        carrinho = (lista)[:i]
        fatorben = valornut*5/valor
        preco = valor
      if (fatorben >= benMinimo):
        halt = 0
      if (halt != 1):
        j = j + 1
      i = 0
      valor = 0.0
      valornut = 0
      break
      

print("De acordo com o orcamento de R$", precoLimite,"\b. Sugerimos este carrinho:", carrinho)
print("Com o preco de: R$", format(preco,".2f"))
print("Custo beneficio: ", fatorben)
